<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KFZ-Angebots-Konfigurator</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
        h1, h2 { color: #333; }
        #totalPrice { color: #007bff; }
        
        /* Allgemeine Anpassung der Checkbox-Label-Ausrichtung */
        label { margin-left: 15px; cursor: pointer; display: inline-block; vertical-align: middle; } 
        
        /* Schrift der Leistungen doppelt so gro√ü */
        #servicesContainer label {
            font-size: 2em;
            line-height: 1.5em;
        }
        
        /* NEU: Fahrzeugart Auswahlfeld doppelt so gro√ü */
        #vehicleFilter {
            /* Skaliert das Element auf die doppelte Gr√∂√üe */
            transform: scale(2); 
            /* Sorgt daf√ºr, dass die Skalierung linksb√ºndig startet */
            transform-origin: left; 
            /* F√ºgt oben und unten mehr Platz hinzu */
            margin: 20px 0 20px 20px; 
            padding: 5px;
            /* Stellt sicher, dass das Element als Block behandelt wird, um die Skalierung zu unterst√ºtzen */
            display: block; 
        }

        /* Checkboxen doppelt so gro√ü */
        input[type="checkbox"] { 
            transform: scale(2);
            margin-right: 5px; 
            vertical-align: middle;
        }
        
        hr { border: 0; height: 1px; background: #ccc; margin: 40px 0; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <h1>üõ†Ô∏è Angebots-Konfigurator</h1>
    <p>Leistungen und Preise werden automatisch aus der Datei **Daten.csv** geladen. Es werden **Bruttopreise** verwendet.</p>
    
    <div id="statusMessage" class="success" style="margin-top: 10px;">Daten werden geladen...</div>

    <hr>

    <h2>1. Fahrzeugart w√§hlen:</h2>
    <select id="vehicleFilter" disabled>
        <option value="">-- Fahrzeugart ausw√§hlen --</option>
    </select>
    
    <div id="servicesContainer" style="margin-top: 60px;">
        <h2>2. Leistungen ausw√§hlen:</h2>
        <p id="promptText">Bitte warten, bis die Daten geladen sind...</p>
    </div>
    
    <hr>

    <h2 style="margin-top: 20px;">3. Gesamtpreis (Brutto):</h2>
    <div id="totalPrice" style="font-size: 1.8em; font-weight: bold; color: #007bff;">‚Ç¨ 0,00</div>

<script>
    const CSV_FILE_PATH = 'Daten.csv';
    
    const vehicleFilter = document.getElementById('vehicleFilter');
    const servicesContainer = document.getElementById('servicesContainer');
    const totalPriceDisplay = document.getElementById('totalPrice');
    const statusDiv = document.getElementById('statusMessage');
    
    let allPriceData = [];

    document.getElementById('vehicleFilter').addEventListener('change', filterAndDisplayServices);
    
    // === Daten automatisch laden ===
    async function loadDataFromCSV() {
        try {
            const response = await fetch(CSV_FILE_PATH);
            if (!response.ok) {
                throw new Error(`Konnte die Datei nicht laden: Status ${response.status}`);
            }
            const csvText = await response.text();
            processData(csvText);
        } catch (error) {
            statusDiv.className = 'error';
            statusDiv.textContent = `FEHLER: ${error.message}. √úberpr√ºfen Sie den Dateinamen und das Hosting-Setup.`;
            vehicleFilter.disabled = true;
        }
    }
    
    // Funktion, die die Daten aus dem CSV-Text verarbeitet
    function processData(csvText) {
        const lines = csvText.split(/\r\n|\n/);
        allPriceData = [];
        const vehicleTypes = new Set();
        let isValidData = false;

        for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;
            
            const separator = line.includes(';') ? ';' : ',';
            const columns = line.split(separator).map(col => col.trim().replace(/"/g, ''));

            if (columns.length >= 5) {
                const priceBrutto = parseFloat(columns[4].replace(',', '.')); 
                
                allPriceData.push({
                    artikelnummer: columns[0],
                    dienstleistung: columns[1],
                    fahrzeugart: columns[2],
                    preisBrutto: priceBrutto
                });
                vehicleTypes.add(columns[2]);
                isValidData = true;
            }
        }

        if (isValidData) {
            statusDiv.className = 'success';
            statusDiv.textContent = `Daten erfolgreich aus "${CSV_FILE_PATH}" geladen.`;
            populateVehicleFilter(vehicleTypes);
        } else {
            statusDiv.className = 'error';
            statusDiv.textContent = 'FEHLER: Keine g√ºltigen Daten (mind. 5 Spalten erwartet) in der CSV-Datei gefunden.';
            vehicleFilter.disabled = true;
        }
    }

    // === Dropdown-Liste mit Fahrzeugarten f√ºllen ===
    function populateVehicleFilter(vehicleTypes) {
        vehicleFilter.innerHTML = '<option value="">-- Fahrzeugart ausw√§hlen --</option>';
        vehicleTypes.forEach(type => {
            const option = document.createElement('option');
            option.value = type;
            option.textContent = type;
            vehicleFilter.appendChild(option);
        });
        vehicleFilter.disabled = false;
        servicesContainer.querySelector('#promptText').textContent = 'Bitte w√§hlen Sie eine Fahrzeugart, um die Leistungen zu sehen.';
    }

    // === Filtern und Checkboxen anzeigen ===
    function filterAndDisplayServices() {
        const selectedVehicle = vehicleFilter.value;
        
        const currentElements = servicesContainer.querySelectorAll(':not(h2)');
        currentElements.forEach(el => el.remove());
        totalPriceDisplay.textContent = '‚Ç¨ 0,00';

        if (!selectedVehicle) {
            servicesContainer.innerHTML += '<p id="promptText">Bitte w√§hlen Sie eine Fahrzeugart, um die Leistungen zu sehen.</p>';
            return;
        }

        const filteredServices = allPriceData.filter(item => item.fahrzeugart === selectedVehicle);
        
        filteredServices.forEach(item => {
            const checkboxId = `service-${item.artikelnummer}`;
            
            const div = document.createElement('div');
            div.style.marginBottom = '20px';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = checkboxId;
            checkbox.value = item.preisBrutto;
            checkbox.addEventListener('change', calculateTotal);
            
            const label = document.createElement('label');
            label.htmlFor = checkboxId;
            label.textContent = `${item.dienstleistung} (${formatPrice(item.preisBrutto)} Brutto)`;

            div.appendChild(checkbox);
            div.appendChild(label);
            servicesContainer.appendChild(div);
        });
    }

    // === Gesamtpreis berechnen ===
    function calculateTotal() {
        let total = 0;
        const selectedCheckboxes = servicesContainer.querySelectorAll('input[type="checkbox"]:checked');
        
        selectedCheckboxes.forEach(checkbox => {
            total += parseFloat(checkbox.value);
        });

        totalPriceDisplay.textContent = formatPrice(total);
    }
    
    // Hilfsfunktion zur Preisformatierung
    function formatPrice(amount) {
        return amount.toLocaleString('de-DE', { style: 'currency', currency: 'EUR' });
    }

    loadDataFromCSV();
</script>
</body>
</html>
