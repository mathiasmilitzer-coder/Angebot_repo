<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KFZ-Angebots-Konfigurator</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: auto; }
        h1, h2 { color: #333; }
        #totalPrice { color: #007bff; }
        
        /* Allgemeine Anpassung der Checkbox-Label-Ausrichtung */
        label { margin-left: 15px; cursor: pointer; display: inline-block; vertical-align: middle; } 
        
        /* NEU: Schrift der Leistungen 1/3 der aktuellen Gr√∂√üe (ca. 0.66em) */
        #servicesContainer label {
            font-size: 0.66em; /* Stark reduziert f√ºr kompakte Ansicht */
            line-height: 1.2em; /* Angepasst an kleine Schrift */
        }
        
        /* Fahrzeugart Auswahlfeld doppelt so gro√ü */
        #vehicleFilter {
            transform: scale(2); 
            transform-origin: left; 
            margin: 20px 0 20px 20px; 
            padding: 5px;
            display: block; 
        }

        /* Checkboxen doppelt so gro√ü */
        input[type="checkbox"] { 
            transform: scale(2);
            margin-right: 5px; 
            vertical-align: middle;
        }
        
        hr { border: 0; height: 1px; background: #ccc; margin: 40px 0; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }

        /* Flex-Container f√ºr Innen- und Au√üenbereich */
        #servicesFlexContainer {
            display: flex;
            justify-content: space-between;
            gap: 40px;
            margin-top: 20px;
        }
        /* Style f√ºr die einzelnen Spalten */
        .service-column {
            flex: 1;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        .service-column h3 {
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
            margin-top: 0;
        }
        .service-item {
            margin-bottom: 5px; /* Kleinerer Abstand f√ºr kompaktes Layout */
        }
    </style>
</head>
<body>

    <h1>üõ†Ô∏è Angebots-Konfigurator</h1>
    <p>Leistungen und Preise werden automatisch aus der Datei **Daten.csv** geladen. Es werden **Bruttopreise** verwendet.</p>
    
    <div id="statusMessage" class="success" style="margin-top: 10px;">Daten werden geladen...</div>

    <hr>

    <h2>1. Fahrzeugart w√§hlen:</h2>
    <select id="vehicleFilter" disabled>
        <option value="">-- Fahrzeugart ausw√§hlen --</option>
    </select>
    
    <div id="servicesContainer" style="margin-top: 60px;">
        <h2>2. Leistungen ausw√§hlen:</h2>
        <p id="promptText">Bitte warten, bis die Daten geladen sind...</p>
        
        <div id="servicesFlexContainer">
            <div id="servicesInnen" class="service-column">
                <h3>Innenreinigung & Aufbereitung</h3>
            </div>
            <div id="servicesAussen" class="service-column">
                <h3>Au√üenpflege & Lackarbeiten</h3>
            </div>
        </div>
    </div>
    
    <hr>

    <h2 style="margin-top: 20px;">3. Gesamtpreis (Brutto):</h2>
    <div id="totalPrice" style="font-size: 1.8em; font-weight: bold; color: #007bff;">‚Ç¨ 0,00</div>

<script>
    const CSV_FILE_PATH = 'Daten.csv';
    
    const vehicleFilter = document.getElementById('vehicleFilter');
    const servicesInnen = document.getElementById('servicesInnen');
    const servicesAussen = document.getElementById('servicesAussen');
    const totalPriceDisplay = document.getElementById('totalPrice');
    const statusDiv = document.getElementById('statusMessage');
    
    let allPriceData = [];

    document.getElementById('vehicleFilter').addEventListener('change', filterAndDisplayServices);
    
    // === Daten automatisch laden ===
    async function loadDataFromCSV() {
        try {
            const response = await fetch(CSV_FILE_PATH);
            if (!response.ok) {
                throw new Error(`Konnte die Datei nicht laden: Status ${response.status}`);
            }
            const csvText = await response.text();
            processData(csvText);
        } catch (error) {
            statusDiv.className = 'error';
            statusDiv.textContent = `FEHLER: ${error.message}. √úberpr√ºfen Sie den Dateinamen und das Hosting-Setup.`;
            vehicleFilter.disabled = true;
        }
    }
    
    // Funktion, die die Daten aus dem CSV-Text verarbeitet
    function processData(csvText) {
        const lines = csvText.split(/\r\n|\n/);
        allPriceData = [];
        const vehicleTypes = new Set();
        let isValidData = false;

        // Erwartet jetzt 6 Spalten: 0:Artikel, 1:Dienstleistung, 2:Fahrzeugart, 3:Netto, 4:Brutto, 5:Bereich
        for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;
            
            const separator = line.includes(';') ? ';' : ',';
            const columns = line.split(separator).map(col => col.trim().replace(/"/g, ''));

            if (columns.length >= 6) {
                const priceBrutto = parseFloat(columns[4].replace(',', '.')); 
                
                allPriceData.push({
                    artikelnummer: columns[0],
                    dienstleistung: columns[1],
                    fahrzeugart: columns[2],
                    preisNetto: parseFloat(columns[3].replace(',', '.')),
                    preisBrutto: priceBrutto, 
                    bereich: columns[5]
                });
                vehicleTypes.add(columns[2]);
                isValidData = true;
            }
        }

        if (isValidData) {
            statusDiv.className = 'success';
            statusDiv.textContent = `Daten erfolgreich aus "${CSV_FILE_PATH}" geladen. (${allPriceData.length} Eintr√§ge)`;
            populateVehicleFilter(vehicleTypes);
        } else {
            statusDiv.className = 'error';
            statusDiv.textContent = 'FEHLER: Keine g√ºltigen Daten (mind. 6 Spalten erwartet) in der CSV-Datei gefunden. Bitte CSV pr√ºfen.';
            vehicleFilter.disabled = true;
        }
    }

    // === Dropdown-Liste mit Fahrzeugarten f√ºllen ===
    function populateVehicleFilter(vehicleTypes) {
        vehicleFilter.innerHTML = '<option value="">-- Fahrzeugart ausw√§hlen --</option>';
        vehicleTypes.forEach(type => {
            const option = document.createElement('option');
            option.value = type;
            option.textContent = type;
            vehicleFilter.appendChild(option);
        });
        vehicleFilter.disabled = false;
        document.getElementById('promptText').textContent = 'Bitte w√§hlen Sie eine Fahrzeugart, um die Leistungen zu sehen.';
        clearServiceContainers();
    }

    // Hilfsfunktion zum Leeren der Container
    function clearServiceContainers() {
        // Entfernt alle dynamisch erzeugten Elemente, beh√§lt aber die √úberschriften bei
        servicesInnen.querySelectorAll('.service-item').forEach(el => el.remove());
        servicesAussen.querySelectorAll('.service-item').forEach(el => el.remove());
    }

    // === Filtern und Checkboxen anzeigen ===
    function filterAndDisplayServices() {
        const selectedVehicle = vehicleFilter.value;
        
        clearServiceContainers();
        totalPriceDisplay.textContent = '‚Ç¨ 0,00';

        if (!selectedVehicle) {
            document.getElementById('promptText').textContent = 'Bitte w√§hlen Sie eine Fahrzeugart, um die Leistungen zu sehen.';
            return;
        }

        document.getElementById('promptText').textContent = '';

        const filteredServices = allPriceData.filter(item => item.fahrzeugart === selectedVehicle);
        
        filteredServices.forEach(item => {
            const checkboxId = `service-${item.artikelnummer}`;
            
            const div = document.createElement('div');
            div.className = 'service-item';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = checkboxId;
            checkbox.value = item.preisBrutto;
            checkbox.addEventListener('change', calculateTotal);
            
            const label = document.createElement('label');
            label.htmlFor = checkboxId;
            label.textContent = `${item.dienstleistung} (${formatPrice(item.preisBrutto)} Brutto)`;

            div.appendChild(checkbox);
            div.appendChild(label);

            // Zuweisung basierend auf dem "Bereich"
            if (item.bereich && item.bereich.toUpperCase() === 'INNEN') {
                servicesInnen.appendChild(div);
            } else if (item.bereich && item.bereich.toUpperCase() === 'AUSSEN') {
                servicesAussen.appendChild(div);
            }
        });
    }

    // === Gesamtpreis berechnen ===
    function calculateTotal() {
        let total = 0;
        const selectedCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        
        selectedCheckboxes.forEach(checkbox => {
            total += parseFloat(checkbox.value);
        });

        totalPriceDisplay.textContent = formatPrice(total);
    }
    
    // Hilfsfunktion zur Preisformatierung
    function formatPrice(amount) {
        return amount.toLocaleString('de-DE', { style: 'currency', currency: 'EUR' });
    }

    loadDataFromCSV();
</script>
</body>
</html>
